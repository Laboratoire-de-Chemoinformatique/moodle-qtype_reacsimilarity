define("qtype_reacsimilarity/chemdoodle_canvas",["exports","./api_helper"],(function(_exports,_api_helper){Object.defineProperty(_exports,"__esModule",{value:!0}),_exports.insert_scaffold=_exports.insert_good_answer=_exports.insert_form_preview=_exports.insert_form=_exports.insert_cwc=void 0;_exports.insert_cwc=(toreplaceid,name,inputname,readonly,questionid)=>{const scaffold=(0,_api_helper.retrieveScafold)(questionid);let ChemDoodle=window.ChemDoodleVar,location_isida=document.querySelector("#"+inputname),sketcher=document.querySelector("#"+name);if(readonly)sketcher=new ChemDoodle.ViewerCanvas(toreplaceid,400,300),sketcher.emptyMessage="No data loaded",style(sketcher);else{sketcher=new ChemDoodle.SketcherCanvas(toreplaceid,550,300,{useServices:!1,oneMolecule:!1}),style(sketcher),document.getElementById(toreplaceid+"_button_bond_half_label").remove();let initmol=ChemDoodle.readJSON('{"m":[{"a":[]}]}');sketcher.doChecks=!0,sketcher.loadMolecule(initmol.molecules[0]);document.getElementById("responseform").addEventListener("submit",(function(){let json_data=JSON.stringify((new ChemDoodle.io.JSONInterpreter).contentTo(sketcher.molecules,sketcher.shapes));if('{"m":[{"a":[]}]}'!==json_data){let reac=ChemDoodle.writeRXN(sketcher.getMolecules(),sketcher.shapes);(0,_api_helper.generateOutputChemDoodle)(reac,json_data,location_isida)}return!0}))}let lastmol=document.getElementById(inputname).value;if(sketcher.doChecks=!0,lastmol.length>0){sketcher.doChecks=!0;let cmcmol=ChemDoodle.readJSON(JSON.parse(lastmol).json);sketcher.loadContent(cmcmol.molecules,cmcmol.shapes),sketcher.repaint()}else if(""!==scaffold&&scaffold){sketcher.doChecks=!0;let cmcmol=JSON.parse(scaffold),data=ChemDoodle.readJSON(cmcmol.json);0!==data.shapes.length?sketcher.loadContent(data.molecules,data.shapes):sketcher.loadMolecule(data.molecules[0])}else{let initmol=ChemDoodle.readJSON('{"m":[{"a":[]}]}');sketcher.loadMolecule(initmol.molecules[0])}};const style=sketcher=>{let ChemDoodle=window.ChemDoodleVar;sketcher.styles.atoms_useJMOLColors=!0,sketcher.styles.bonds_clearOverlaps_2D=!0,ChemDoodle.ELEMENT.H.jmolColor="black",ChemDoodle.ELEMENT.S.jmolColor="#B9A130"},get_source=parent=>{let buttonname=parent.getAttribute("name"),textfieldid="id_answer_"+buttonname.substr(buttonname.length-2,1);return document.querySelector("#".concat(textfieldid))};_exports.insert_form=()=>{let ChemDoodle=window.ChemDoodleVar;ChemDoodle.ELEMENT.H.jmolColor="black",ChemDoodle.ELEMENT.S.jmolColor="#B9A130";let sketcher=new ChemDoodle.SketcherCanvas("sketcher",550,300,{useServices:!1,oneMolecule:!1});sketcher.styles.atoms_useJMOLColors=!0,sketcher.styles.bonds_clearOverlaps_2D=!0,document.getElementById("sketcher_button_bond_half_label").remove(),document.querySelector("[classo=set-molfile]").addEventListener("click",(function(){let parent=this;if(0!==sketcher.shapes.length){let molfile=ChemDoodle.writeRXN(sketcher.getMolecules(),sketcher.shapes),json_data=JSON.stringify((new ChemDoodle.io.JSONInterpreter).contentTo(sketcher.molecules,sketcher.shapes));window.console.log(json_data),window.console.log(ChemDoodle.readJSON(json_data));let box=get_source(parent);(0,_api_helper.generateOutputChemDoodle)(molfile,json_data,box),box.value.length>=1&&(document.querySelector("[classo = mol_empty]").style.display="none",document.querySelector("[classo = needreac]").style.display="none")}else{let neereacElt=document.querySelector("[classo = needreac]");"none"==neereacElt.style.display?neereacElt.style.display="block":neereacElt.style.display="none"}})),document.querySelector("[classo=load-molfile]").addEventListener("click",(function(){let box=get_source(this);if(box.value){let val=JSON.parse(box.value),data=ChemDoodle.readJSON(val.json);sketcher.doChecks=!0,sketcher.loadContent(data.molecules,data.shapes),document.querySelector("[classo = mol_empty]").style.display="none"}})),document.querySelector("[classo=clear_answer]").addEventListener("click",(function(){let box=get_source(this);box.value&&(box.value="")}))};const get_source_preview=parent=>{let groupname=parent.getAttribute("data-groupname"),textfieldid="id_answer_"+groupname.substr(groupname.length-2,1);return document.querySelector("#".concat(textfieldid))};_exports.insert_form_preview=()=>{let ChemDoodle=window.ChemDoodleVar,sketcherlist=document.getElementsByName("test_preview"),listlength=sketcherlist.length;for(let i=0;i<listlength;++i){let id="sketcher_preview";id+=i,sketcherlist[i].id=id;let sketcher=document.querySelector("#"+id);sketcher=new ChemDoodle.ViewerCanvas(id,250,125),sketcher.emptyMessage="No data loaded",sketcher.styles.atoms_useJMOLColors=!0,sketcher.styles.bonds_clearOverlaps_2D=!0;let parent=sketcherlist[i].parentNode.parentNode.parentNode,box=get_source_preview(parent);if(box.value){let val=JSON.parse(box.value),data=ChemDoodle.readJSON(val.json);sketcher.clear(),sketcher.doChecks=!0,sketcher.loadContent(data.molecules,data.shapes)}else sketcher.clear();let boxval=box.value;setInterval((function(){if(boxval!==box.value)if(boxval=box.value,""===boxval)sketcher.clear();else{let val=JSON.parse(box.value),data=ChemDoodle.readJSON(val.json);sketcher.clear(),sketcher.doChecks=!0,sketcher.loadContent(data.molecules,data.shapes),sketcher.repaint()}}),5e3)}};_exports.insert_good_answer=(toreplaceid,name,questionid)=>{let ChemDoodle=window.ChemDoodleVar,sketcher=document.querySelector("#"+name);sketcher=new ChemDoodle.ViewerCanvas(toreplaceid,400,300),sketcher.emptyMessage="No data loaded",sketcher.styles.atoms_useJMOLColors=!0,sketcher.styles.bonds_clearOverlaps_2D=!0;let correct_mol=(0,_api_helper.retrieveCorrectDatas)(questionid);if(correct_mol.length>0){let cmcmol=ChemDoodle.readJSON(correct_mol);sketcher.doChecks=!0,sketcher.loadContent(cmcmol.molecules,cmcmol.shapes)}};_exports.insert_scaffold=()=>{let ChemDoodle=window.ChemDoodleVar,nameS="sketcherScaffold",sketcherS=document.querySelector("#"+nameS);sketcherS=new ChemDoodle.SketcherCanvas(nameS,550,300,{useServices:!1,oneMolecule:!1}),sketcherS.emptyMessage="No data loaded",sketcherS.styles.atoms_useJMOLColors=!0,sketcherS.styles.bonds_clearOverlaps_2D=!0,sketcherS.repaint();let scaffoldarea=document.querySelector("input[name=scaffold]"),scaffoldData=scaffoldarea.value;if(scaffoldData.length>0){sketcherS.doChecks=!0;let cmcmol=JSON.parse(scaffoldData),data=ChemDoodle.readJSON(cmcmol.json);0!==data.shapes.length?sketcherS.loadContent(data.molecules,data.shapes):sketcherS.loadMolecule(data.molecules[0])}document.querySelector("form[data-qtype=reacsimilarity]").addEventListener("submit",(function(){var json_data=JSON.stringify((new ChemDoodle.io.JSONInterpreter).contentTo(sketcherS.molecules));if("{}"!==json_data){if(0!==sketcherS.shapes.length){json_data=JSON.stringify((new ChemDoodle.io.JSONInterpreter).contentTo(sketcherS.molecules,sketcherS.shapes));var molscaf=ChemDoodle.writeRXN(sketcherS.getMolecules(),sketcherS.shapes)}else molscaf=ChemDoodle.writeMOL(sketcherS.getMolecule());"Molecule from ChemDoodle Web Components\n\nhttp://www.ichemlabs.com\n  1  0  0  0  0  0            999 V2000\n    0.0000    0.0000    0.0000 C   0  0  0  0  0  0\nM  END"!==molscaf&&(0,_api_helper.generateOutputChemDoodle)(molscaf,json_data,scaffoldarea)}else scaffoldarea.value="";return!0}))}}));

//# sourceMappingURL=chemdoodle_canvas.min.js.map